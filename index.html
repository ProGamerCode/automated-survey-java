<!DOCTYPE html><html><head><title>Automated Surveys in Java (Spark)</title><style>body, html {
  height:100%;
  width:100%;
  padding:0;
  margin:0;
  overflow:hidden;
  background-color:#ddd;
}
.wrapper {
  height:100%;
  width:100%;
}</style><link rel="shortcut icon" href="//twilio.com/bundles/marketing/img/favicons/favicon.ico"><link rel="apple-touch-icon" href="//twilio.com/bundles/marketing/img/favicons/favicon_57.png"><link rel="apple-touch-icon" sizes="72x72" href="//twilio.com/bundles/marketing/img/favicons/favicon_72.png"><link rel="apple-touch-icon" sizes="114x114" href="//twilio.com/bundles/marketing/img/favicons/favicon_114.png"><link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css"><link rel="stylesheet" href="viewsaurus.css"></head><body><div class="wrapper"><div id="viewsaurus" data-title="Automated Surveys in Java (Spark)"><div class="saurus-panes"><div class="saurus-prose"><div class="saurus-prose-header"><div class="title-outer"><span class="step-title">Automated Surveys in Java (Spark)</span></div></div><div class="saurus-nav-buttons"><div class="saurus-nav-button nav-overview"><div class="saurus-nav-button-inner"><i class="fa fa-fw fa-list"></i></div><div class="nav-divider"></div></div><div class="saurus-nav-button nav-previous"><div class="saurus-nav-button-inner"><a href=""> <i class="fa fa-fw fa-play fa-rotate-180"></i></a></div><div class="nav-divider"></div></div><div class="saurus-nav-button nav-next clickable"><div class="saurus-nav-button-inner"><a href="#1"> <i class="fa fa-fw fa-play"></i></a></div></div><div class="saurus-next-title"><span class="next-title-inner"></span></div></div><div class="saurus-progress-bar"></div><div class="saurus-start"><p>Learn to create an automated telephone survey in Java with Twilio.</p><a href="#0">Start Tutorial</a></div><div class="saurus-content"><div data-title="Automated Surveys in Java (Spark)" class="chapter"><div data-file="com/twilio/survey/Server.java" class="step"><h2 id="about-this-application">About This Application</h2>
<p>This <a href="http://sparkjava.com">Spark</a> app uses the <a href="https://www.twilio.com/docs/api/twiml">Twilio API</a>
to create an automated survey conducted over a phone call. Callers will
interact with this application over the phone, by calling your Twilio number,
while you can view the results on a dynamic dashboard.</p>
<p>Check out the source code for this application on <a href="http://github.com/twilio/automated-survey-java">GitHub</a>.</p>
<p>In this tutorial, we&#39;ll highlight the code that interacts with Twilio and in
 turn makes the application tick. <a href="http://github.com/twilio/automated-survey-java">Check out the project README on GitHub</a>
 to see how to run the code yourself.</p>
<p>Let&#39;s get started! Click the right arrow above to advance to the next code snippet.</p>
<hr>
<p><strong>See also:</strong></p>
<ul>
<li><a href="https://www.twilio.com/docs/java/install">Twilio Java Helper Library</a></li>
<li><a href="https://www.twilio.com/docs/quickstart/java">Twilio Java Quickstart Tutorials</a></li>
<li><a href="https://www.twilio.com/docs/api/twiml">TwiML: The Twilio Markup Language</a></li>
<li><a href="https://www.twilio.com/docs/api/twiml">Spark: Java Web framework</a></li>
<li><a href="https://mongodb.github.io/mongo-java-driver/2.13/getting-started/quick-tour/">MongoDB&#39;s Java Driver</a></li>
<li><a href="http://mongodb.github.io/morphia/">MongoDB&#39;s Morphia Document-Object Mapper</a></li>
<li><a href="https://github.com/google/gson">Google&#39;s Gson JSON-to-Java-Object library</a></li>
</ul>
</div><div data-title="Create a survey" data-file="questions.json" class="step"><h2 id="create-a-survey">Create a survey</h2>
<p>Before we get responses, let&#39;s specify the questions we would like to ask.</p>
<p>Each question is created as a <a href="http://json.org">JSON object</a> with two attributes: 
<code>text</code>, which holds the question we&#39;d like to ask, and <code>type</code>, which describes 
the kind of input we expect a caller to provide when asked that question.</p>
<p>Our app reads this JSON into a Java object using Google&#39;s 
<a href="https://sites.google.com/site/gson/gson-user-guide#TOC-Overview">Gson</a> library.</p>
</div><div data-file="com/twilio/survey/controllers/SurveyController.java" data-highlight="30-47" class="step"><h2 id="accept-a-call">Accept a call</h2>
<p>Every time your Twilio number receives a call, Twilio will send an HTTP request 
to the application, asking what to do next. The application responds with 
<a href="https://www.twilio.com/docs/api/twiml">TwiML</a> that describes the action 
(<code>&lt;Say&gt;</code> a phrase, <code>&lt;Gather&gt;</code> input, among others).</p>
<p>First, your Twilio number must be configured to make requests to the 
<code>/interview</code> route of this application. Go to your 
<a href="https://www.twilio.com/user/account/phone-numbers/">Manage Numbers</a> page, and 
set up a new TwiML application using one of your Twilio numbers.</p>
<hr>
<p><strong>See also:</strong></p>
<ul>
<li><a href="https://www.twilio.com/help/faq/twilio-client/how-do-i-create-a-twiml-app">How do I create a TwiML App?</a></li>
</ul>
</div><div data-file="com/twilio/survey/controllers/SurveyController.java" data-highlight="77-116" class="step"><h2 id="ask-a-question">Ask a question</h2>
<p>Once the application receives an HTTP request from Twilio, it creates a TwiML 
response containing a <code>&lt;Say&gt;</code> verb for the question&#39;s text and a 
<code>&lt;Gather&gt;</code> or <code>&lt;Record&gt;</code> verb to collect input based on the question&#39;s 
type, as specified in <a href="#1">questions.json</a>.</p>
<p>TwiML verbs have properties that allow you to change the way the verb works. 
For example, the <code>&lt;Record&gt;</code> verb always collects audio input, but, using 
the <code>transcribeCallback</code> property, you can specify a route to which Twilio 
will send a transcript of the audio input. For more on TwiML verbs and their 
properties, check out the <a href="https://www.twilio.com/docs/api/twiml">TwiML API documentation</a>.</p>
<hr>
<p><strong>See also:</strong></p>
<ul>
<li><a href="https://www.twilio.com/docs/api/twiml/say">TwiML Voice: &lt;Say&gt;</a></li>
<li><a href="https://www.twilio.com/docs/api/twiml/record">TwiML Voice: &lt;Record&gt;</a></li>
<li><a href="https://www.twilio.com/docs/api/twiml/gather">TwiML Voice: &lt;Gather&gt;</a></li>
</ul>
</div><div data-file="com/twilio/survey/controllers/SurveyController.java" data-highlight="61-74" class="step"><h2 id="use-a-transcript-of-a-recorded-response">Use a transcript of a recorded response</h2>
<p>When Twilio finishes transcribing a free-form voice response, the application 
finds the corresponding survey, and updates the response for that question to 
include the transcription. This makes it easier to skim the responses without 
listening to the full call.</p>
<hr>
<p><strong>See also:</strong></p>
<ul>
<li><a href="https://www.twilio.com/docs/api/twiml/record">TwiML Voice: &lt;Record&gt;</a></li>
</ul>
</div><div data-file="com/twilio/survey/models/SurveyService.java" data-highlight="51-57" class="step"><h2 id="store-a-caller-s-response">Store a caller&#39;s response</h2>
<p>After each TwiML verb is executed and input is collected, Twilio sends the 
application that input, along with a request for more TwiML. The<br><code>/interview</code> route in our controller handles that input, and passes it to 
the model to update the survey. Using MongoDB&#39;s <a href="http://mongodb.github.io/morphia/">Morphia</a> 
document-object mapper, the question index, responses, and completeness status 
of the survey are updated.</p>
<hr>
<p><strong>See also:</strong></p>
<ul>
<li>Learn about the data provided in <a href="https://www.twilio.com/docs/api/twiml/twilio_request">Twilio&#39;s Request</a></li>
<li>MongoDB&#39;s <a href="http://mongodb.github.io/morphia/1.0/getting-started/quick-tour">Morphia Quick Tour</a></li>
<li>Morphia API: <a href="http://mongodb.github.io/morphia/1.0/javadoc/index.html?org/mongodb/morphia/query/UpdateOperations.html">UpdateOperations</a></li>
<li>Morphia Wiki: <a href="https://github.com/mongodb/morphia/wiki/Datastore">Datastore Interface</a></li>
</ul>
</div><div data-file="com/twilio/survey/controllers/SurveyController.java" data-highlight="49-59" class="step"><h2 id="display-survey-results">Display survey results</h2>
<p>To view the results, the completed surveys are serialized to 
<a href="http://json.org">JSON</a>, which is used to populate the dashboard. The dashboard 
is served on the root (<code>/</code>) URL of the application. We use <a href="http://jquery.com">jQuery</a> 
to call this route via Ajax, and display the results in charts on the home page.</p>
<hr>
<p><strong>See also:</strong></p>
<ul>
<li><a href="https://sites.google.com/site/gson/gson-user-guide#TOC-Overview">Google Gson: Overview</a></li>
<li><a href="http://api.jquery.com/jQuery.ajax/">AJAX requests in jQuery</a></li>
</ul>
</div><div class="step"><h2 id="where-to-next-">Where to next?</h2>
<p>Pat yourself on the back! You&#39;ve finished this tutorial, but there&#39;s much more
good stuff where this came from. If you&#39;re hungry for more ways to work with 
Twilio APIs in Java, check out one of the other tutorials, like:</p>
<h3 id="-appointment-reminders-https-www-twilio-com-docs-howto-walkthrough-appointment-reminders-java-spark-"><a href="https://www.twilio.com/docs/howto/walkthrough/appointment-reminders/java/spark">Appointment Reminders</a></h3>
<p>Automate the process of reaching out to your customers in advance of an upcoming 
appointment.</p>
<h3 id="did-this-help-">Did this help?</h3>
<p>Thanks for checking out this tutorial! If you have any feedback to share with 
us, we&#39;d love to hear it. Tweet <a href="http://twitter.com/twilio">@twilio</a> to let us 
know what you think.</p>
</div></div>
<div class="saurus-files" style="display:none;"><textarea class="saurus-file" data-file="com/twilio/survey/Server.java" data-mode="java">cGFja2FnZSBjb20udHdpbGlvLnN1cnZleTsKCmltcG9ydCBzdGF0aWMgc3BhcmsuU3BhcmsuKjsKCmltcG9ydCBjb20udHdpbGlvLnN1cnZleS5jb250cm9sbGVycy5TdXJ2ZXlDb250cm9sbGVyOwppbXBvcnQgY29tLnR3aWxpby5zdXJ2ZXkudXRpbC5Db25maWc7CgpwdWJsaWMgY2xhc3MgU2VydmVyIHsKICAvLyBDcmVhdGUgZmllbGQgdG8gaG9sZCBlbnZpcm9ubWVudCBjb25maWd1cmF0aW9uLgogIHB1YmxpYyBzdGF0aWMgQ29uZmlnIGNvbmZpZzsKCiAgLy8gQm9vdHN0cmFwIG91ciBhcHBsaWNhdGlvbgogIHB1YmxpYyBzdGF0aWMgdm9pZCBtYWluKFN0cmluZ1tdIGFyZ3MpIHsKICAgIC8vIFB1bGwgaW4gZW52aXJvbm1lbnQgdmFyaWFibGVzIGZvciBNb25nb0RCIGFuZCBwb3J0IGNvbmZpZ3VyYXRpb24uCiAgICBjb25maWcgPSBuZXcgQ29uZmlnKCk7CgogICAgLy8gY29uZmlndXJlIFNwYXJrIHRvIHVzZSB0aGUgZGVzaXJlZCBwb3J0LgogICAgcG9ydChTZXJ2ZXIuY29uZmlnLmdldFBvcnQoKSk7CgogICAgLy8gTWFwIHJvdXRlcyB0byBjb250cm9sbGVycy4KICAgIHN0YXRpY0ZpbGVMb2NhdGlvbigiL3B1YmxpYyIpOwogICAgcG9zdCgiL2ludGVydmlldyIsIFN1cnZleUNvbnRyb2xsZXIuaW50ZXJ2aWV3KTsKICAgIHBvc3QoIi9pbnRlcnZpZXcvOnBob25lL3RyYW5zY3JpYmUvOnF1ZXN0aW9uIiwgU3VydmV5Q29udHJvbGxlci50cmFuc2NyaWJlKTsKICAgIGdldCgiL3Jlc3VsdHMiLCBTdXJ2ZXlDb250cm9sbGVyLnJlc3VsdHMpOwogICAgCiAgfQp9Cg==</textarea>
<textarea class="saurus-file" data-file="questions.json" data-mode="json">WwogICAgewogICAgICAgICJ0ZXh0IjogIlBsZWFzZSB0ZWxsIHVzIHlvdXIgYWdlLiIsCiAgICAgICAgInR5cGUiOiAibnVtYmVyIgogICAgfSwKICAgIHsKICAgICAgICAidGV4dCI6ICJIYXZlIHlvdSBldmVyIGp1bXAta2lja2VkIGEgbGVtdXI/IiwKICAgICAgICAidHlwZSI6ICJib29sZWFuIgogICAgfSwKICAgIHsKICAgICAgICAidGV4dCI6ICJXaG8gaXMgeW91ciBmYXZvcml0ZSBUZWVuYWdlIE11dGFudCBOaW5qYSBUdXJ0bGUgYW5kIHdoeT8iLAogICAgICAgICJ0eXBlIjogInRleHQiCiAgICB9Cl0=</textarea>
<textarea class="saurus-file" data-file="com/twilio/survey/controllers/SurveyController.java" data-mode="java">cGFja2FnZSBjb20udHdpbGlvLnN1cnZleS5jb250cm9sbGVyczsKCmltcG9ydCBjb20udHdpbGlvLnN1cnZleS5TZXJ2ZXI7CmltcG9ydCBjb20udHdpbGlvLnN1cnZleS5tb2RlbHMuUmVzcG9uc2U7CmltcG9ydCBjb20udHdpbGlvLnN1cnZleS5tb2RlbHMuU3VydmV5U2VydmljZTsKaW1wb3J0IGNvbS50d2lsaW8uc3VydmV5Lm1vZGVscy5TdXJ2ZXk7CmltcG9ydCBjb20udHdpbGlvLnN1cnZleS51dGlsLkluY29taW5nQ2FsbDsKaW1wb3J0IGNvbS50d2lsaW8uc3VydmV5LnV0aWwuUXVlc3Rpb247CmltcG9ydCBjb20udHdpbGlvLnNkay52ZXJicy5HYXRoZXI7CmltcG9ydCBjb20udHdpbGlvLnNkay52ZXJicy5SZWNvcmQ7CmltcG9ydCBjb20udHdpbGlvLnNkay52ZXJicy5TYXk7CmltcG9ydCBjb20udHdpbGlvLnNkay52ZXJicy5Ud2lNTEV4Y2VwdGlvbjsKaW1wb3J0IGNvbS50d2lsaW8uc2RrLnZlcmJzLlR3aU1MUmVzcG9uc2U7CgppbXBvcnQgY29tLmdvb2dsZS5nc29uLkdzb247CmltcG9ydCBjb20uZ29vZ2xlLmdzb24uSnNvbk9iamVjdDsKCmltcG9ydCBzcGFyay5Sb3V0ZTsKCmltcG9ydCBqYXZhLmlvLlVuc3VwcG9ydGVkRW5jb2RpbmdFeGNlcHRpb247CmltcG9ydCBqYXZhLm5ldC5VUkxEZWNvZGVyOwppbXBvcnQgamF2YS5uZXQuVVJMRW5jb2RlcjsKaW1wb3J0IGphdmEudXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLk1hcDsKCnB1YmxpYyBjbGFzcyBTdXJ2ZXlDb250cm9sbGVyIHsKICBwcml2YXRlIHN0YXRpYyBTdXJ2ZXlTZXJ2aWNlIHN1cnZleXMgPSBuZXcgU3VydmV5U2VydmljZShTZXJ2ZXIuY29uZmlnLmdldE1vbmdvVVJJKCkpOwoKICAvLyBNYWluIGludGVydmlldyBsb29wLgogIHB1YmxpYyBzdGF0aWMgUm91dGUgaW50ZXJ2aWV3ID0gKHJlcXVlc3QsIHJlc3BvbnNlKSAtPiB7CiAgICBJbmNvbWluZ0NhbGwgY2FsbCA9IG5ldyBJbmNvbWluZ0NhbGwocGFyc2VCb2R5KHJlcXVlc3QuYm9keSgpKSk7CiAgICBUd2lNTFJlc3BvbnNlIHR3aW1sID0gbmV3IFR3aU1MUmVzcG9uc2UoKTsKICAgIFN1cnZleSBleGlzdGluZ1N1cnZleSA9IHN1cnZleXMuZ2V0U3VydmV5KGNhbGwuZ2V0RnJvbSgpKTsKICAgIGlmIChleGlzdGluZ1N1cnZleSA9PSBudWxsKSB7CiAgICAgIFN1cnZleSBzdXJ2ZXkgPSBzdXJ2ZXlzLmNyZWF0ZVN1cnZleShjYWxsLmdldEZyb20oKSk7CiAgICAgIHR3aW1sLmFwcGVuZChuZXcgU2F5KCJUaGFua3MgZm9yIHRha2luZyBvdXIgc3VydmV5LiIpKTsKICAgICAgY29udGludWVTdXJ2ZXkoc3VydmV5LCB0d2ltbCk7CiAgICB9IGVsc2UgaWYgKCFleGlzdGluZ1N1cnZleS5pc0RvbmUoKSkgewogICAgICBleGlzdGluZ1N1cnZleS5hcHBlbmRSZXNwb25zZShuZXcgUmVzcG9uc2UoY2FsbC5nZXRJbnB1dCgpKSk7CiAgICAgIHN1cnZleXMudXBkYXRlU3VydmV5KGV4aXN0aW5nU3VydmV5KTsKICAgICAgaWYgKCFleGlzdGluZ1N1cnZleS5pc0RvbmUoKSkgewogICAgICAgIGNvbnRpbnVlU3VydmV5KGV4aXN0aW5nU3VydmV5LCB0d2ltbCk7CiAgICAgIH0KICAgIH0KICAgIHR3aW1sLmFwcGVuZChuZXcgU2F5KCJZb3VyIHJlc3BvbnNlcyBoYXZlIGJlZW4gcmVjb3JkZWQuIFRoYW5rIHlvdSBmb3IgeW91ciB0aW1lISIpKTsKICAgIHJldHVybiB0d2ltbC50b1hNTCgpOwogIH07CgogIC8vIFJlc3VsdHMgYWNjZXNzb3Igcm91dGUKICBwdWJsaWMgc3RhdGljIFJvdXRlIHJlc3VsdHMgPSAocmVxdWVzdCwgcmVzcG9uc2UpIC0+IHsKICAgIEdzb24gZ3NvbiA9IG5ldyBHc29uKCk7CiAgICBKc29uT2JqZWN0IGpzb24gPSBuZXcgSnNvbk9iamVjdCgpOwogICAgICAvLyBBZGQgcXVlc3Rpb25zIHRvIHRoZSBKU09OIHJlc3BvbnNlIG9iamVjdAogICAgICBqc29uLmFkZCgic3VydmV5IiwgZ3Nvbi50b0pzb25UcmVlKFNlcnZlci5jb25maWcuZ2V0UXVlc3Rpb25zKCkpKTsKICAgICAgLy8gQWRkIHVzZXIgcmVzcG9uc2VzIHRvIHRoZSBKU09OIHJlc3BvbnNlIG9iamVjdAogICAgICBqc29uLmFkZCgicmVzdWx0cyIsIGdzb24udG9Kc29uVHJlZShzdXJ2ZXlzLmZpbmRBbGxGaW5pc2hlZFN1cnZleXMoKSkpOwogICAgICByZXNwb25zZS50eXBlKCJhcHBsaWNhdGlvbi9qc29uIik7CiAgICAgIHJldHVybiBqc29uOwogICAgfTsKCiAgLy8gVHJhbnNjcmlwdGlvbiByb3V0ZSAoY2FsbGVkIGJ5IFR3aWxpbydzIGNhbGxiYWNrLCBvbmNlIHRyYW5zY3JpcHRpb24gaXMgY29tcGxldGUpCiAgcHVibGljIHN0YXRpYyBSb3V0ZSB0cmFuc2NyaWJlID0gKHJlcXVlc3QsIHJlc3BvbnNlKSAtPiB7CiAgICBJbmNvbWluZ0NhbGwgY2FsbCA9IG5ldyBJbmNvbWluZ0NhbGwocGFyc2VCb2R5KHJlcXVlc3QuYm9keSgpKSk7CiAgICAgIC8vIEdldCB0aGUgcGhvbmUgYW5kIHF1ZXN0aW9uIG51bWJlcnMgZnJvbSB0aGUgVVJMIHBhcmFtZXRlcnMgcHJvdmlkZWQgYnkgdGhlICJSZWNvcmQiIHZlcmIKICAgICAgU3RyaW5nIHN1cnZleUlkID0gcmVxdWVzdC5wYXJhbXMoIjpwaG9uZSIpOwogICAgICBpbnQgcXVlc3Rpb25JZCA9IEludGVnZXIucGFyc2VJbnQocmVxdWVzdC5wYXJhbXMoIjpxdWVzdGlvbiIpKTsKICAgICAgLy8gRmluZCB0aGUgc3VydmV5IGluIHRoZSBEQi4uLgogICAgICBTdXJ2ZXkgc3VydmV5ID0gc3VydmV5cy5nZXRTdXJ2ZXkoc3VydmV5SWQpOwogICAgICAvLyAuLi5hbmQgdXBkYXRlIGl0IHdpdGggb3VyIHRyYW5zY3JpcHRpb24gdGV4dC4KICAgICAgc3VydmV5LmdldFJlc3BvbnNlcygpW3F1ZXN0aW9uSWRdLnNldEFuc3dlcihjYWxsLmdldFRyYW5zY3JpcHRpb25UZXh0KCkpOwogICAgICBzdXJ2ZXlzLnVwZGF0ZVN1cnZleShzdXJ2ZXkpOwogICAgICByZXNwb25zZS5zdGF0dXMoMjAwKTsKICAgICAgcmV0dXJuICJPSyI7CiAgICB9OwoKICAvLyBIZWxwZXIgbWV0aG9kcwogIHByb3RlY3RlZCBzdGF0aWMgU3RyaW5nIGNvbnRpbnVlU3VydmV5KFN1cnZleSBzdXJ2ZXksIFR3aU1MUmVzcG9uc2UgdHdpbWwpIHRocm93cyBUd2lNTEV4Y2VwdGlvbiwKICAgICAgVW5zdXBwb3J0ZWRFbmNvZGluZ0V4Y2VwdGlvbiB7CiAgICBRdWVzdGlvbiBxdWVzdGlvbiA9IFNlcnZlci5jb25maWcuZ2V0UXVlc3Rpb25zKClbc3VydmV5LmdldEluZGV4KCldOwogICAgU2F5IHNheSA9IG5ldyBTYXkocXVlc3Rpb24uZ2V0VGV4dCgpKTsKICAgIHR3aW1sLmFwcGVuZChzYXkpOwogICAgLy8gRGVwZW5kaW5nIG9uIHRoZSBxdWVzdGlvbiB0eXBlLCBjcmVhdGUgZGlmZmVyZW50IFR3aU1MIHZlcmJzLgogICAgc3dpdGNoIChxdWVzdGlvbi5nZXRUeXBlKCkpIHsKICAgICAgY2FzZSAidGV4dCI6CiAgICAgICAgU2F5IHRleHRJbnN0cnVjdGlvbnMgPQogICAgICAgICAgICBuZXcgU2F5KAogICAgICAgICAgICAgICAgIllvdXIgcmVzcG9uc2Ugd2lsbCBiZSByZWNvcmRlZCBhZnRlciB0aGUgdG9uZS4gT25jZSB5b3UgaGF2ZSBmaW5pc2hlZCByZWNvcmRpbmcsIHByZXNzIHRoZSAjLiIpOwogICAgICAgIHR3aW1sLmFwcGVuZCh0ZXh0SW5zdHJ1Y3Rpb25zKTsKICAgICAgICBSZWNvcmQgdGV4dCA9IG5ldyBSZWNvcmQoKTsKICAgICAgICB0ZXh0LnNldEZpbmlzaE9uS2V5KCIjIik7CiAgICAgICAgLy8gVXNlIHRoZSBUcmFuc2NyaXB0aW9uIHJvdXRlIHRvIHJlY2VpdmUgdGhlIHRleHQgb2YgYSB2b2ljZSByZXNwb25zZS4KICAgICAgICB0ZXh0LnNldFRyYW5zY3JpYmUodHJ1ZSk7CiAgICAgICAgdGV4dC5zZXRUcmFuc2NyaWJlQ2FsbGJhY2soIi9pbnRlcnZpZXcvIiArIHVybEVuY29kZShzdXJ2ZXkuZ2V0UGhvbmUoKSkgKyAiL3RyYW5zY3JpYmUvIgogICAgICAgICAgICArIHN1cnZleS5nZXRJbmRleCgpKTsKICAgICAgICB0d2ltbC5hcHBlbmQodGV4dCk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgImJvb2xlYW4iOgogICAgICAgIFNheSBib29sSW5zdHJ1Y3Rpb25zID0KICAgICAgICAgICAgbmV3IFNheSgiUHJlc3MgMCB0byByZXNwb25kICdObywnIGFuZCBwcmVzcyBhbnkgb3RoZXIgbnVtYmVyIHRvIHJlc3BvbmQgJ1llcy4nIik7CiAgICAgICAgdHdpbWwuYXBwZW5kKGJvb2xJbnN0cnVjdGlvbnMpOwogICAgICAgIEdhdGhlciBib29sZWFuR2F0aGVyID0gbmV3IEdhdGhlcigpOwogICAgICAgIC8vIExpc3RlbiBvbmx5IGZvciBvbmUgZGlnaXQuCiAgICAgICAgYm9vbGVhbkdhdGhlci5zZXROdW1EaWdpdHMoMSk7CiAgICAgICAgdHdpbWwuYXBwZW5kKGJvb2xlYW5HYXRoZXIpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJudW1iZXIiOgogICAgICAgIFNheSBudW1JbnN0cnVjdGlvbnMgPSBuZXcgU2F5KCJFbnRlciB0aGUgbnVtYmVyIG9uIHlvdXIga2V5cGFkLCBmb2xsb3dlZCBieSB0aGUgIy4iKTsKICAgICAgICB0d2ltbC5hcHBlbmQobnVtSW5zdHJ1Y3Rpb25zKTsKICAgICAgICBHYXRoZXIgbnVtYmVyR2F0aGVyID0gbmV3IEdhdGhlcigpOwogICAgICAgIC8vIExpc3RlbiB1bnRpbCBhIHVzZXIgcHJlc3NlcyAiIyIKICAgICAgICBudW1iZXJHYXRoZXIuc2V0RmluaXNoT25LZXkoIiMiKTsKICAgICAgICB0d2ltbC5hcHBlbmQobnVtYmVyR2F0aGVyKTsKICAgICAgICBicmVhazsKICAgIH0KICAgIHJldHVybiB0d2ltbC50b1hNTCgpOwogIH0KCiAgLy8gU3BhcmsgaGFzIG5vIGJ1aWx0LWluIGJvZHkgcGFyc2VyLCBzbyBsZXQncyByb2xsIG91ciBvd24uCiAgcHVibGljIHN0YXRpYyBNYXA8U3RyaW5nLCBTdHJpbmc+IHBhcnNlQm9keShTdHJpbmcgYm9keSkgdGhyb3dzIFVuc3VwcG9ydGVkRW5jb2RpbmdFeGNlcHRpb24gewogICAgU3RyaW5nW10gdW5wYXJzZWRQYXJhbXMgPSBib2R5LnNwbGl0KCImIik7CiAgICBNYXA8U3RyaW5nLCBTdHJpbmc+IHBhcnNlZFBhcmFtcyA9IG5ldyBIYXNoTWFwPFN0cmluZywgU3RyaW5nPigpOwogICAgZm9yIChpbnQgaSA9IDA7IGkgPCB1bnBhcnNlZFBhcmFtcy5sZW5ndGg7IGkrKykgewogICAgICBTdHJpbmdbXSBwYXJhbSA9IHVucGFyc2VkUGFyYW1zW2ldLnNwbGl0KCI9Iik7CiAgICAgIGlmIChwYXJhbS5sZW5ndGggPT0gMikgewogICAgICAgIHBhcnNlZFBhcmFtcy5wdXQodXJsRGVjb2RlKHBhcmFtWzBdKSwgdXJsRGVjb2RlKHBhcmFtWzFdKSk7CiAgICAgIH0gZWxzZSBpZiAocGFyYW0ubGVuZ3RoID09IDEpIHsKICAgICAgICBwYXJzZWRQYXJhbXMucHV0KHVybERlY29kZShwYXJhbVswXSksICIiKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHBhcnNlZFBhcmFtczsKICB9CgogIC8vIFdyYXAgdGhlIFVSTEVuY29kZXIgYW5kIFVSTERlY29kZXIgZm9yIGNsZWFubGluZXNzLgogIHB1YmxpYyBzdGF0aWMgU3RyaW5nIHVybEVuY29kZShTdHJpbmcgcykgdGhyb3dzIFVuc3VwcG9ydGVkRW5jb2RpbmdFeGNlcHRpb24gewogICAgcmV0dXJuIFVSTEVuY29kZXIuZW5jb2RlKHMsICJ1dGYtOCIpOwogIH0KCiAgcHVibGljIHN0YXRpYyBTdHJpbmcgdXJsRGVjb2RlKFN0cmluZyBzKSB0aHJvd3MgVW5zdXBwb3J0ZWRFbmNvZGluZ0V4Y2VwdGlvbiB7CiAgICByZXR1cm4gVVJMRGVjb2Rlci5kZWNvZGUocywgInV0Zi04Iik7CiAgfQp9Cg==</textarea>
<textarea class="saurus-file" data-file="com/twilio/survey/models/SurveyService.java" data-mode="java">cGFja2FnZSBjb20udHdpbGlvLnN1cnZleS5tb2RlbHM7CgppbXBvcnQgY29tLnR3aWxpby5zdXJ2ZXkuU2VydmVyOwoKaW1wb3J0IGNvbS5tb25nb2RiLk1vbmdvQ2xpZW50OwppbXBvcnQgY29tLm1vbmdvZGIuTW9uZ29DbGllbnRVUkk7CmltcG9ydCBvcmcubW9uZ29kYi5tb3JwaGlhLkRhdGFzdG9yZTsKaW1wb3J0IG9yZy5tb25nb2RiLm1vcnBoaWEuTW9ycGhpYTsKaW1wb3J0IG9yZy5tb25nb2RiLm1vcnBoaWEucXVlcnkuVXBkYXRlT3BlcmF0aW9uczsKCmltcG9ydCBqYXZhLnV0aWwuTGlzdDsKCnB1YmxpYyBjbGFzcyBTdXJ2ZXlTZXJ2aWNlIHsKICAvLyBNb25nb0NsaWVudCBhbmQgTW9ycGhpYSBpbnN0YW5jZXMgbXVzdCBiZSBhY2Nlc3NpYmxlIHRvIHRoZSBlbnRpcmUgb2JqZWN0LCBzbyBhIERhdGFzdG9yZSBjYW4KICAvLyBiZSBidWlsdC4KICBNb25nb0NsaWVudCBtb25nb0NsaWVudDsKICBNb3JwaGlhIG1vcnBoaWE7CgogIC8vIEFuIGluc3RhbmNlIG9mIERhdGFzdG9yZSBtdXN0IGJlIGFjY2Vzc2libGUgdG8gdGhlIGVudGlyZSBvYmplY3QsIHNvIGFsbCBpbnN0YW5jZSBtZXRob2RzIGNhbgogIC8vIHBlcnNpc3QgdG8gYW5kIHJlYWQgZnJvbSB0aGUgZGF0YXN0b3JlLgogIERhdGFzdG9yZSBkYXRhc3RvcmU7CgogIC8vIENvbnN0cnVjdG9yCiAgcHVibGljIFN1cnZleVNlcnZpY2UoTW9uZ29DbGllbnRVUkkgbW9uZ29VUkkpIHsKICAgIHRyeSB7CiAgICAgIC8vIENyZWF0ZSBNb25nb0RCIGRyaXZlcnMKICAgICAgbW9uZ29DbGllbnQgPSBuZXcgTW9uZ29DbGllbnQobW9uZ29VUkkpOwogICAgICBtb3JwaGlhID0gbmV3IE1vcnBoaWEoKTsKCiAgICAgIC8vIEFzayB0aGUgTW9ycGhpYSBkcml2ZXIgdG8gc2NhbiB0aGUgTW9kZWxzIHBhY2thZ2UgZm9yIG1vZGVscy4KICAgICAgbW9ycGhpYS5tYXBQYWNrYWdlKCJjb20udHdpbGlvLnN1cnZleS5tb2RlbHMiKTsKCiAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAvLyBDYXRjaCBhbnkgTW9uZ29EQiBjb25maWd1cmF0aW9uIGVycm9ycywgYW5kIHBhc3MgdGhlbSBiYWNrIHRvIFNUREVSUi4KICAgICAgU3lzdGVtLmVyci5wcmludGxuKGUuZ2V0TWVzc2FnZSgpKTsKICAgIH0gZmluYWxseSB7CiAgICAgIC8vIENyZWF0ZSBhIGRhdGFzdG9yZSB3aXRoIHRoZSBkYXRhYmFzZSBuYW1lIHByb3ZpZGVkLgogICAgICBkYXRhc3RvcmUgPSBtb3JwaGlhLmNyZWF0ZURhdGFzdG9yZShtb25nb0NsaWVudCwgU2VydmVyLmNvbmZpZy5nZXRNb25nb0RCTmFtZSgpKTsKICAgIH0KICB9CiAgCiAgcHVibGljIFN1cnZleVNlcnZpY2UoKSB7CiAgICB0aGlzKFNlcnZlci5jb25maWcuZ2V0TW9uZ29VUkkoKSk7CiAgfQoKICAvLyBGaW5kLCBVcGRhdGUsIGFuZCBDcmVhdGUgLS0gZGF0YWJhc2Ugb3BlcmF0aW9ucy4KICBwdWJsaWMgU3VydmV5IGdldFN1cnZleShTdHJpbmcgcGhvbmUpIHsKICAgIHJldHVybiBkYXRhc3RvcmUuZmluZChTdXJ2ZXkuY2xhc3MpLmZpZWxkKCJwaG9uZSIpLmVxdWFsKHBob25lKS5nZXQoKTsKICB9CgogIHB1YmxpYyB2b2lkIHVwZGF0ZVN1cnZleShTdXJ2ZXkgc3VydmV5KSB7CiAgICBVcGRhdGVPcGVyYXRpb25zPFN1cnZleT4gdXBkYXRlcyA9IGRhdGFzdG9yZS5jcmVhdGVVcGRhdGVPcGVyYXRpb25zKFN1cnZleS5jbGFzcyk7CiAgICB1cGRhdGVzLnNldCgiaW5kZXgiLCBzdXJ2ZXkuZ2V0SW5kZXgoKSk7CiAgICB1cGRhdGVzLnNldCgicmVzcG9uc2VzIiwgc3VydmV5LmdldFJlc3BvbnNlcygpKTsKICAgIHVwZGF0ZXMuc2V0KCJkb25lIiwgc3VydmV5LmlzRG9uZSgpKTsKICAgIGRhdGFzdG9yZS51cGRhdGUoc3VydmV5LCB1cGRhdGVzKTsKICB9CgogIHB1YmxpYyBTdXJ2ZXkgY3JlYXRlU3VydmV5KFN0cmluZyBwaG9uZSkgewogICAgU3VydmV5IGV4aXN0aW5nU3VydmV5ID0gZ2V0U3VydmV5KHBob25lKTsKICAgIGlmIChleGlzdGluZ1N1cnZleSA9PSBudWxsKSB7CiAgICAgIFN1cnZleSBzdXJ2ZXkgPSBuZXcgU3VydmV5KHBob25lKTsKICAgICAgZGF0YXN0b3JlLnNhdmUoc3VydmV5KTsKICAgICAgcmV0dXJuIHN1cnZleTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBleGlzdGluZ1N1cnZleTsKICAgIH0KICB9CgogIHB1YmxpYyBMaXN0PFN1cnZleT4gZmluZEFsbEZpbmlzaGVkU3VydmV5cygpIHsKICAgIHJldHVybiBkYXRhc3RvcmUuZmluZChTdXJ2ZXkuY2xhc3MpLmZpZWxkKCJkb25lIikuZXF1YWwodHJ1ZSkuYXNMaXN0KCk7CiAgfQp9Cg==</textarea>
</div>
</div><div class="saurus-overview"><ul></ul></div></div><div class="saurus-code"><div class="file-path"><span class="crumb-container"></span><i class="fa fa-fw fa-folder"></i></div><div class="saurus-editor"></div></div><div class="saurus-explorer"><div class="saurus-file-list"></div><a href="https://github.com/twilio/automated-survey-java" target="_blank" class="explorer-get-code"> <i class="fa fa-lg fa-github-square"> </i>View Code on GitHub</a></div></div></div></div><script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min.js"></script><script src="ace/ace.js"></script><script src="ace/theme-monokai.js"></script><script src="viewsaurus.js"></script></body></html>